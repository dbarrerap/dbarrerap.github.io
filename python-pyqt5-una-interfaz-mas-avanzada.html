<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Pelican" />
        <title>Coding OverloadPython + PyQt5: Una interfaz mas avanzada</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
        <meta name="description" content="Despues de mi post acerca de usar guizero, me puse a investigar y sacar conclusiones y me di cuenta que guizero llega hasta cierto punto, luego se..." />
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-secondary bg-gradient mb-3">
        <div class="container">
            <a href="/" class="navbar-brand">Coding Overload</a>
            <span class="navbar-text">Pushing buttons until it works...</span>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarMenu">
                <ul class="navbar-nav">
<li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" id="navbarCategorias" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Categorias
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarCategorias">
                            <li><a href="https://dbarrerap.github.io/category/programming.html" class="dropdown-item">Programming</a></li>
                        </ul>
                    </li>
<li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" id="navbarCategorias" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Social
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarCategorias">
                            <li>
                                <a href="https://instagram.com/dbarrera.dev" class="dropdown-item">
                                    <i class="bi bi-instagram"></i> Instagram
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/dbarrerap" class="dropdown-item">
                                    <i class="bi bi-github"></i> Github
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container pb-5">
<header class="mt-5 mb-3">
    <h1>Python + PyQt5: Una interfaz mas avanzada</h1>
<div class="alert alert-secondary text-muted">
    Publicado: 2020/05/07
    <br>Autores: David E. Barrera</div></header>
<p>Despues de mi <a href="https://dbarrerap.github.io/creando-una-aplicacion-en-python-con-guizero.html">post</a> acerca de usar <code>guizero</code>, me puse a investigar y sacar conclusiones y me di cuenta que <code>guizero</code> llega hasta cierto punto, luego se mezcla con <code>tkinter</code> y se vuelve una sola mezcla y un dolor de cabeza. El siguiente paso lo da <code>Qt</code>. Qt es un framework multiplataforma que permite el desarrollo de la interfaz para multiples lenguajes. En nuestro caso lo aplicaremos con Python.</p>
<p>El objetivo de la guia de hoy es crear una aplicacion que permita la conversion de monedas. Los objetivos de aprendizaje son:</p>
<ul>
<li>Crear una interfaz con Qt</li>
<li>Consumir una API via HTTP</li>
</ul>
<h2>Qt</h2>
<p>Como habia mencionado antes, Qt es un framework de desarrollo de aplicaciones multiplataforma para desktop, embebido y móvil. Esto es, desarrollo la interfaz en una plataforma (Linux, por ejemplo) y funcionara de igual manera en todas las otras plataformas (Windows, macOS, iOS, Android, BlackBerry entre otros).</p>
<h2>Qt Designer</h2>
<p>Qt Designer es una aplicacion que nos permitira crear una interfaz grafica de manera sencilla y exportarla para ser usada con el lenguaje de programacion de preferencia. Seguir las instrucciones de instalado en <a href="https://build-system.fman.io/qt-designer-download">este enlace</a>.</p>
<h2>Signals + Slots</h2>
<p>Qt maneja una nomenclatura diferente a las usuales, pero no es de espantarse. Una señal, <code>signal</code>, es lo que en otros lenguajes se denomina un <code>evento</code>, por ejemplo: <code>clicked</code>, <code>valueChanged</code>.</p>
<p>Por otro lado, las ranuras, <code>slots</code>, se denomina la funcion llamada cuando se emite un evento, tambien llamado un <code>callback</code>.</p>
<h2>Dependencias</h2>
<p>Para usar Qt con Python, debemos instalar el paquete <code>pyqt5</code>.</p>
<div class="highlight"><pre><span></span><code>$ pip3 install pyqt5
</code></pre></div>

<h2>Una aplicacion basica</h2>
<p>Lo primero a realizar es importar los componentes o <code>widgets</code> y creamos nuestra ventana.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">MiVentana</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Mi Primera App con PyQt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

        <span class="c1"># Aqui se agregan los widgets</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">mainWin</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
    <span class="n">mainWin</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</code></pre></div>

<p>Parece mucho, pero esto ayuda a que la ventana mantenga su estado. Lo cual nos beneficia en nuestro ejemplo. Si ejeutamos el codigo, nos debe aparecer una ventana vacia.</p>
<p>Muy bien, ahora haremos algo mas interactivo, un contador! Para esto necesitaremos 2 widgets principalmente, un <code>QLabel</code> y un <code>QPushButton</code>. Yo incluire una segunda etiqueta y un <code>QVBoxLayout</code> por cuestiones cosmeticas. Un VBox lo que hace es ubicar los widgets de manera vertical y con cierto espacio entre los componentes y el filo de la ventana.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># counter.py</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">MiVentana</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Mi Primera App con PyQt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_text</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Has presionado el boton esta cantidad de veces:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_count</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl_count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Presioname!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">mainWin</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
    <span class="n">mainWin</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</code></pre></div>

<p>Con esto ya tenemos nuestra interfaz, la cual deberia verse de la siguiente manera.</p>
<div class="row"><div class="col-md-4 offset-md-4">
<img src="https://dbarrerap.github.io/images/ScreenShot2020-05-07_1203.png" class="img-fluid">
</div></div>

<p>Al presionar el boton no sucede nada. Por ahora. Arreglemos eso!</p>
<div class="highlight"><pre><span></span><code><span class="c1"># counter.py</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">MiVentana</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Mi Primera App con PyQt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contador</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_text</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Has presionado el boton esta cantidad de veces:&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_count</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbl_count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Presioname!&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verticalLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_button</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">contar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contador</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbl_count</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contador</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">mainWin</span> <span class="o">=</span> <span class="n">MainWindow</span><span class="p">()</span>
    <span class="n">mainWin</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</code></pre></div>

<p>Perfecto! Ahora tenemos una pequeña app que cuenta cuantas veces hemos dado un clic en el boton. </p>
<div class="row"><div class="col-md-4 offset-md-4">
<img src="https://dbarrerap.github.io/images/ScreenShot2020-05-07_1420.png" class="img-fluid">
</div></div>

<p>Repasemos lo que hemos visto.</p>
<p>Hemos visto como usar un <code>QVBoxLayout</code> para organizar nuestros widgets de manera vertical en la aplicacion. Tambien existe un <code>QHBoxLayout</code> que nos permite organizar de manera horizontal.</p>
<p>Tambien hemos visto como establecer y actualizar el texto en un <code>QLabel</code>, mediante el uso del metodo <code>setText()</code>. Algo muy particular es que solo recibe elementos del tipo String. Por lo cual si es de escribir un numero, hay que convertirlo a texto.</p>
<p>Al crear una clase para manejar el contenido de la ventana, nos da la flexibilidad de manejar su estado, esto es, nos permite actualizar los elementos internos; en este ejemplo en particular, nos permite actualiza el contenido de la etiqueta <code>lbl_count</code>, como lo hemos hecho en el metodo <code>contar()</code>.</p>
<p>Muy bien, ahora a lo que vinimos. Vamos a crear una aplicacion que nos permitira convertir una moneda en otra, por ejemplo de Dolares Americanos a Euros.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">MiVentana</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Convertidor de Moneda&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_1</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmb_from</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmb_from</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="s1">&#39;EUR&#39;</span><span class="p">,</span> <span class="s1">&#39;GBP&#39;</span><span class="p">,</span> <span class="s1">&#39;CAD&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmb_from</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_from</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_from</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_1</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_from</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_2</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmb_to</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmb_to</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;USD&#39;</span><span class="p">,</span> <span class="s1">&#39;EUR&#39;</span><span class="p">,</span> <span class="s1">&#39;GBP&#39;</span><span class="p">,</span> <span class="s1">&#39;CAD&#39;</span><span class="p">,</span> <span class="s1">&#39;JPY&#39;</span><span class="p">,</span> <span class="s1">&#39;NZD&#39;</span><span class="p">,</span> <span class="s1">&#39;HKD&#39;</span><span class="p">,</span> <span class="s1">&#39;MXN&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmb_to</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Para escoger un valor diferente</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmb_to</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_to</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_to</span><span class="o">.</span><span class="n">setReadOnly</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Lo usaremos en modo solo lectura</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_2</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_to</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_convert</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Convertir&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_convert</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_from</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmb_from</span><span class="o">.</span><span class="n">currentText</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmb_to</span><span class="o">.</span><span class="n">currentText</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_convert</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centralWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">convertir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monto</span><span class="p">,</span> <span class="n">cur_from</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cur_to</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.exchangeratesapi.io/latest&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="n">cur_from</span><span class="p">,</span> <span class="s1">&#39;symbols&#39;</span><span class="p">:</span> <span class="n">cur_to</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">cambio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">monto</span><span class="p">)</span> <span class="o">*</span> <span class="n">json</span><span class="p">[</span><span class="s1">&#39;rates&#39;</span><span class="p">][</span><span class="n">cur_to</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">txt_to</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cambio</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">MiVentana</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</code></pre></div>

<p>La interfaz de nuestra aplicacion se ve de la siguiente manera.</p>
<div class="row"><div class="col-md-4 offset-md-4">
<img src="https://dbarrerap.github.io/images/ScreenShot2020=05-07_1421.png" class="img-fluid">
</div></div>

<p>Veamos lo nuevo en este codigo. Aqui hemos usado un nuevo widget llamado <code>QComboBox</code> que nos permite la seleccion en una lista de items. Para agregar items tenemos dos formas de hacerlo: <code>addItem()</code>, para agregar item por item, y <code>addItems()</code>, para agregar una lista de items. De manera predeterminada se escoge el primer elemento de la lista, pero si deseamos escoger otro elemento usamos el metodo <code>setCurrentIndex()</code> con un valor valido, esto es menor a la longitud de la lista, ya que el indice en una lista empieza en 0.</p>
<p>Tambien, como debemos proveer un valor monetario para realizar el cambio, usamos un <code>QLineEdit</code> que nos permite el ingreso de datos via teclado a la aplicacion. De este podemos modificar una propiedad de solo lectura mediante el metodo <code>setReadOnly()</code>, como lo hemos en el segundo campo.</p>
<p>Un detalle adicional es el uso de <code>lambda</code> al momento de conectar la señal <code>clicked</code> con el slot <code>convertir()</code>. De manera predeterminada el metodo <code>connect()</code> solamente acepta la referencia a un metodo, los cual nos bloquea el enviar argumentos al metodo. Como es necesario el envio de argumentos en este caso, ya que debemos enviar las monedas y monto para hacer el cambio, usamos una lambda que nos permite hacer justamente esto [<a href="https://eli.thegreenplace.net/2011/04/25/passing-extra-arguments-to-pyqt-slot">Fuente</a>].</p>
<p>Finalmente, tenemos el metodo <code>convertir()</code>, cuyos parametros son el monto a convertir, la moneda base y la moneda de conversion. Para realizar la conversion, consultamos con una API, <a href="https://exchangeratesapi.io/">Exchange Rates</a>, el cambio del dia mediante la libreria <code>requests</code>. Usamos el metodo <code>get()</code> para realizar la consulta pasandole dos argumentos esenciales, la URL a consultar y los parametros de consulta.</p>
<div class="highlight"><pre><span></span><code><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.exchangeratesapi.io/latest&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="n">cur_from</span><span class="p">,</span> <span class="s1">&#39;symbols&#39;</span><span class="p">:</span> <span class="n">cur_to</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</code></pre></div>

<p>Al hacer la consulta, la URL se convierte en <code>https://api.exchangeratesapi.io/latest?base=USD&amp;symbols=EUR</code>, siguiendo el ejemplo de convertir de Dolares Americanos a Euros.</p>
<p>Si existe una respuesta satisfactoria, esto es si el <code>status_code</code> es igual a 200, toma los datos de la respuesta de la API, realiza el cambio de divisas y la muestra en el segundo campo de texto.</p>
<h2>Conclusion</h2>
<p>WOW! Eso fue divertido! Fue mucho por aprender, revisar... Pero como siempre, es de practicar, practicar y practicar...
<code>guizero</code> es un buen sustituto/complemento para <code>tkinter</code>, pero ambos tienen sus complicaciones en cuanto a widgets y ubicacion en pantalla. </p>
<p><code>PyQt</code>, por otro lado, con <code>QVBoxLayout</code> y <code>QHBoxLayout</code> podemos distribuir a manera de columnas y filas los widgets que necesitemos. Adicional, una interfaz Qt es multiplataforma, por lo cual el diseño es consistente entre diferentes sistemas operativos sin perder el estilo. Es verdad, es un poco mas complejo el desarrollo usando este framework, pero hay que pesar tambien sus ventajas.</p>
<h3>Ventajas PyQt</h3>
<ul>
<li><strong>Flexibilidad:</strong> Aunque en los ejemplos mostrados no se aplica, se puede separar la logica del programa de la interfaz. El concepto de señales y slots (eventos y callbacks) hace facil esta comunicacion entre objetos.</li>
<li><strong>Uso de API:</strong> Qt ofrece una amplia gama de APIs para el uso de redes, bases de datos y mas. Sin necesidad de otras librerias.</li>
<li><strong>Componentes nativos:</strong> Como habia mencionado, Qt ofrece muchos widgets diseñados para tener una apariencia nativa en todas las plataformas.</li>
<li><strong>Aprendizaje:</strong> PyQt es una de los frameworks mas usados en varios lenguajes, por lo cual documentacion nunca hara falta.</li>
</ul>
<h3>Desventajas de PyQt</h3>
<ul>
<li>En cuanto a Python, no existe documentacion especifica para PyQt5.</li>
<li>Requiere practica y tiempo para entender todos los detalles de Qt, lo cual hace una curva de aprendizaje bastante empinada.</li>
</ul>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
</body>
</html>